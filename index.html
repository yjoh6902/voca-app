<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã®Ïñ¥ ÏïîÍ∏∞ Ïï±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .achievement-score {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        .content {
            padding: 30px;
        }

        .settings-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e1e8ff;
        }

        .settings-title {
            font-size: 1.3em;
            color: #4a5568;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 500;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .radio-option:hover {
            background-color: #e2e8f0;
        }

        .radio-option input[type="radio"] {
            margin: 0;
            cursor: pointer;
        }

        select {
            width: 100px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .quiz-type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .quiz-type-option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .quiz-type-option:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.15);
        }

        .quiz-type-option.selected {
            border-color: #4facfe;
            background: #f0f9ff;
        }

        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .game-area {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 1px solid #e1e8ff;
        }

        .status-text {
            font-size: 1.2em;
            color: #4a5568;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .word-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .meaning-display {
            font-size: 1.5em;
            color: #4a5568;
            margin: 15px 0;
        }

        .feedback {
            font-size: 1.2em;
            margin: 15px 0;
            font-weight: 600;
            min-height: 25px;
        }

        .feedback.correct {
            color: #48bb78;
        }

        .feedback.incorrect {
            color: #f56565;
        }

        .feedback.warning {
            color: #ed8936;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 25px 0;
        }

        .quiz-option {
            padding: 15px 25px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1em;
        }

        .quiz-option:hover {
            border-color: #4facfe;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.15);
        }

        .quiz-option.selected {
            border-color: #4facfe;
            background: #f0f9ff;
        }

        .quiz-option:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .answer-input {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.3em;
            text-align: center;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            transition: border-color 0.2s;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .game-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
        }

        .btn-submit {
            background: #48bb78;
            color: white;
        }

        .btn-submit:hover:not(:disabled) {
            background: #38a169;
            transform: translateY(-1px);
        }

        .btn-submit:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }

        .btn-next {
            background: #4facfe;
            color: white;
        }

        .btn-next:hover:not(:disabled) {
            background: #2b6cb0;
            transform: translateY(-1px);
        }

        .btn-next:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }



        @media (max-width: 600px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .content {
                padding: 20px;
            }

            .buttons {
                grid-template-columns: 1fr;
            }

            .quiz-type-grid {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .word-display {
                font-size: 2em;
            }

            .game-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Îã®Ïñ¥ ÏïîÍ∏∞ Ïï±</h1>
            <div class="achievement-score">
                üèÜ ÏÑ±Ï∑®Ï†êÏàò: <span id="achievementScore">0</span>
            </div>
        </div>

        <div class="content">


            <!-- ÌïôÏäµ ÏÑ§Ï†ï -->
            <div class="settings-section">
                <div class="settings-title">‚öôÔ∏è ÌïôÏäµ ÏÑ§Ï†ï</div>
                
                <div class="form-group">
                    <label>ÌïôÏäµ Î™®Îìú:</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="learningMode" value="single" id="modeSingle" checked>
                            <label for="modeSingle">ÏùºÎ≥Ñ ÌïôÏäµ</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="learningMode" value="comprehensive" id="modeComprehensive">
                            <label for="modeComprehensive">Ï¢ÖÌï© ÌïôÏäµ</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="singleDay">ÌïôÏäµÌï† Day:</label>
                    <select id="singleDay"></select>
                    
                    <label for="endDay" class="hidden" id="endDayLabel">Ï¢ÖÎ£å Day (ÏãúÏûë: Day 1):</label>
                    <select id="endDay" class="hidden"></select>
                </div>

                <div class="form-group">
                    <label>ÌÄ¥Ï¶à Ïú†Ìòï:</label>
                    <div class="quiz-type-grid">
                        <div class="quiz-type-option selected" data-type="eng_to_kor">
                            <input type="radio" name="quizType" value="eng_to_kor" checked hidden>
                            ÏòÅÏñ¥ ‚Üí ÌïúÍ∏Ä<br>(Í∞ùÍ¥ÄÏãù)
                        </div>
                        <div class="quiz-type-option" data-type="kor_to_eng">
                            <input type="radio" name="quizType" value="kor_to_eng" hidden>
                            ÌïúÍ∏Ä ‚Üí ÏòÅÏñ¥<br>(Í∞ùÍ¥ÄÏãù)
                        </div>
                        <div class="quiz-type-option" data-type="fill_blank">
                            <input type="radio" name="quizType" value="fill_blank" hidden>
                            ÎπàÏπ∏ Ï±ÑÏö∞Í∏∞<br>(Ï£ºÍ¥ÄÏãù)
                        </div>
                        <div class="quiz-type-option" data-type="mixed">
                            <input type="radio" name="quizType" value="mixed" hidden>
                            Ï¢ÖÌï© ÎûúÎç§<br>(ÌòºÌï©)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Î™®Îìú ÏÑ†ÌÉù Î≤ÑÌäº -->
            <div class="buttons">
                <button class="btn btn-primary" onclick="startStudyMode()">
                    üìñ Îã®Ïñ¥ ÌïôÏäµ (ÌîåÎûòÏãúÏπ¥Îìú)
                </button>
                <button class="btn btn-secondary" onclick="startQuizMode()">
                    üß† Îã®Ïñ¥ ÌÄ¥Ï¶à
                </button>
            </div>

            <!-- Í≤åÏûÑ ÏòÅÏó≠ -->
            <div class="game-area">
                <div class="status-text" id="statusText">Î™®ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                <div class="word-display" id="wordDisplay"></div>
                <div class="meaning-display" id="meaningDisplay"></div>
                <div class="feedback" id="feedback"></div>
                
                <!-- ÌÄ¥Ï¶à ÏòµÏÖò (Í∞ùÍ¥ÄÏãù) -->
                <div class="quiz-options hidden" id="quizOptions"></div>
                
                <!-- Îãµ ÏûÖÎ†• (Ï£ºÍ¥ÄÏãù) -->
                <input type="text" class="answer-input hidden" id="answerInput" placeholder="ÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                
                <!-- Í≤åÏûÑ Î≤ÑÌäº -->
                <div class="game-buttons">
                    <button class="btn-action btn-submit hidden" id="actionButton1"></button>
                    <button class="btn-action btn-next hidden" id="actionButton2"></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let vocabulary = {};
        let statsData = {};
        let achievementData = { total: 0 };
        let currentDayWords = [];
        let currentWordIndex = 0;
        let score = 0;
        let currentDayInfo = "";
        let quizActive = false;
        let studyActive = false;
        let activeQuestionType = null;
        let selectedOption = null;
        let achievementScore = 0;

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadVocabularyFile(); // vocabulary_list.txt ÌååÏùº ÏûêÎèô Î°úÎìú
            updateAchievementDisplay();
        });

        function setupEventListeners() {
            // Î™®Îìú Î≥ÄÍ≤Ω
            document.querySelectorAll('input[name="learningMode"]').forEach(radio => {
                radio.addEventListener('change', updateDaySelectionWidgets);
            });
            
            // ÌÄ¥Ï¶à Ïú†Ìòï ÏÑ†ÌÉù
            document.querySelectorAll('.quiz-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.quiz-type-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                });
            });
            
            // Îãµ ÏûÖÎ†• ÌïÑÎìú
            document.getElementById('answerInput').addEventListener('input', onAnswerEntryChange);
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !document.getElementById('actionButton1').disabled) {
                    document.getElementById('actionButton1').click();
                }
            });
        }

        async function loadVocabularyFile() {
            try {
                const response = await fetch('vocabulary_list.txt');
                if (!response.ok) {
                    throw new Error('vocabulary_list.txt ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
                const content = await response.text();
                parseVocabularyData(content);
            } catch (error) {
                console.error('Îã®Ïñ¥ ÌååÏùº Î°úÎìú Ïã§Ìå®:', error);
                // ÌååÏùºÏù¥ ÏóÜÎäî Í≤ΩÏö∞ ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
                loadSampleData();
            }
        }

        function loadSampleData() {
            const sampleData = `Total Achievement | 0

Day 1
apple - ÏÇ¨Í≥º
book - Ï±Ö
water - Î¨º
house - Ïßë
school - ÌïôÍµê

Day 2
computer - Ïª¥Ìì®ÌÑ∞
phone - Ï†ÑÌôîÍ∏∞
friend - ÏπúÍµ¨
family - Í∞ÄÏ°±
love - ÏÇ¨Îûë

Day 3
beautiful - ÏïÑÎ¶ÑÎã§Ïö¥
happy - ÌñâÎ≥µÌïú
sad - Ïä¨Ìîà
angry - ÌôîÎÇú
excited - Ïã†ÎÇú`;
            
            parseVocabularyData(sampleData);
        }

        function parseVocabularyData(content) {
            try {
                vocabulary = {};
                statsData = {};
                achievementData = { total: 0 };
                
                const lines = content.split('\n');
                let currentDay = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    if (line.startsWith('Total Achievement')) {
                        try {
                            const score = parseInt(line.split('|')[1].trim());
                            achievementData.total = score || 0;
                            achievementScore = achievementData.total;
                        } catch (e) {
                            // ÌååÏã± Ïã§Ìå® Ïãú Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©
                        }
                    } else if (line.toLowerCase().startsWith('day')) {
                        try {
                            const dayNum = parseInt(line.split(' ').pop());
                            currentDay = dayNum;
                            vocabulary[currentDay] = [];
                        } catch (e) {
                            currentDay = null;
                        }
                    } else if (currentDay !== null && line.includes(' - ')) {
                        const [eng, kor, stats] = parseVocabLine(line);
                        if (eng && kor) {
                            vocabulary[currentDay].push([eng, kor]);
                            statsData[`${eng}|${kor}`] = stats;
                        }
                    }
                }
                
                updateDaySelections();
                updateAchievementDisplay();
                
                console.log('Îã®Ïñ¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î°úÎìúÎêòÏóàÏäµÎãàÎã§!');
            } catch (error) {
                console.error('ÌååÏùº ÌòïÏãù Ïò§Î•ò:', error);
                // ÏóêÎü¨ Î∞úÏÉù Ïãú ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
                loadSampleData();
            }
        }

        function parseVocabLine(line) {
            let main = line;
            let stats = [0, 0, 0];
            
            if (line.includes('|')) {
                const parts = line.split('|');
                main = parts[0].trim();
                if (parts[1]) {
                    try {
                        stats = parts[1].trim().split(',').map(x => parseInt(x) || 0);
                    } catch (e) {
                        stats = [0, 0, 0];
                    }
                }
            }
            
            if (main.includes(' - ')) {
                const [eng, kor] = main.split(' - ').map(x => x.trim());
                return [eng, kor, stats];
            }
            
            return [null, null, [0, 0, 0]];
        }

        function updateDaySelections() {
            const days = Object.keys(vocabulary).map(x => parseInt(x)).sort((a, b) => a - b);
            const singleSelect = document.getElementById('singleDay');
            const endSelect = document.getElementById('endDay');
            
            singleSelect.innerHTML = '';
            endSelect.innerHTML = '';
            
            days.forEach(day => {
                const option1 = new Option(`Day ${day}`, day);
                const option2 = new Option(`Day ${day}`, day);
                singleSelect.add(option1);
                endSelect.add(option2);
            });
            
            if (days.length > 0) {
                singleSelect.selectedIndex = 0;
                endSelect.selectedIndex = days.length - 1;
            }
        }

        function updateDaySelectionWidgets() {
            const mode = document.querySelector('input[name="learningMode"]:checked').value;
            const singleDay = document.getElementById('singleDay');
            const endDay = document.getElementById('endDay');
            const endDayLabel = document.getElementById('endDayLabel');
            
            if (mode === 'single') {
                singleDay.classList.remove('hidden');
                endDay.classList.add('hidden');
                endDayLabel.classList.add('hidden');
            } else {
                singleDay.classList.add('hidden');
                endDay.classList.remove('hidden');
                endDayLabel.classList.remove('hidden');
            }
        }

        function getWordsForCurrentMode() {
            const mode = document.querySelector('input[name="learningMode"]:checked').value;
            const days = Object.keys(vocabulary).map(x => parseInt(x)).sort((a, b) => a - b);
            
            if (days.length === 0) {
                alert('Î°úÎìúÎêú Îã®Ïñ¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return null;
            }
            
            let words = [];
            let dayInfo = '';
            
            if (mode === 'single') {
                const selectedDay = parseInt(document.getElementById('singleDay').value);
                words = vocabulary[selectedDay] || [];
                dayInfo = `Day ${selectedDay}`;
            } else {
                const endDay = parseInt(document.getElementById('endDay').value);
                for (let day = 1; day <= endDay; day++) {
                    if (vocabulary[day]) {
                        words = words.concat(vocabulary[day]);
                    }
                }
                dayInfo = endDay === 1 ? 'Day 1' : `Day 1 ~ Day ${endDay}`;
            }
            
            if (words.length === 0) {
                alert('ÌïôÏäµÌï† Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return null;
            }
            
            return { words, dayInfo };
        }

        function startStudyMode() {
            const result = getWordsForCurrentMode();
            if (!result) return;
            
            currentDayWords = [...result.words];
            shuffleArray(currentDayWords);
            currentWordIndex = 0;
            studyActive = true;
            quizActive = false;
            currentDayInfo = result.dayInfo;
            
            clearGameArea();
            document.getElementById('statusText').textContent = `--- ${currentDayInfo} Îã®Ïñ¥ ÌïôÏäµ (${currentDayWords.length}Í∞ú) ---`;
            
            setupStudyButtons();
            displayStudyWord();
        }

        function setupStudyButtons() {
            const button1 = document.getElementById('actionButton1');
            const button2 = document.getElementById('actionButton2');
            
            button1.textContent = 'Îúª Î≥¥Í∏∞';
            button1.className = 'btn-action btn-submit';
            button1.onclick = showMeaning;
            button1.disabled = false;
            button1.classList.remove('hidden');
            
            button2.textContent = 'Îã§Ïùå Îã®Ïñ¥';
            button2.className = 'btn-action btn-next';
            button2.onclick = nextStudyWord;
            button2.disabled = true;
            button2.classList.remove('hidden');
        }

        function displayStudyWord() {
            if (currentWordIndex < currentDayWords.length) {
                const [eng, kor] = currentDayWords[currentWordIndex];
                updateStats(eng, kor, 0); // ÌïôÏäµÌöüÏàò Ï¶ùÍ∞Ä
                const stats = getStats(eng, kor);
                
                document.getElementById('wordDisplay').textContent = `${currentWordIndex + 1}. ${eng}`;
                document.getElementById('meaningDisplay').textContent = `(ÌïôÏäµ:${stats[0]}, ÌÄ¥Ï¶à:${stats[1]}, Ï†ïÎãµ:${stats[2]})`;
                document.getElementById('feedback').textContent = '';
                
                document.getElementById('actionButton1').disabled = false;
                document.getElementById('actionButton2').disabled = true;
            } else {
                // ÌïôÏäµ ÏôÑÎ£å
                document.getElementById('wordDisplay').textContent = 'ÌïôÏäµ ÏôÑÎ£å! üéâ';
                document.getElementById('meaningDisplay').textContent = '';
                document.getElementById('statusText').textContent = `--- ${currentDayInfo} ÌïôÏäµ ÏôÑÎ£å! ---`;
                document.getElementById('actionButton1').disabled = true;
                document.getElementById('actionButton2').disabled = true;
                studyActive = false;
            }
        }

        function showMeaning() {
            if (studyActive && currentWordIndex < currentDayWords.length) {
                const [, kor] = currentDayWords[currentWordIndex];
                document.getElementById('feedback').textContent = `‚Üí ${kor}`;
                document.getElementById('feedback').className = 'feedback';
                document.getElementById('actionButton1').disabled = true;
                document.getElementById('actionButton2').disabled = false;
            }
        }

        function nextStudyWord() {
            if (studyActive) {
                currentWordIndex++;
                displayStudyWord();
            }
        }

        function startQuizMode() {
            const result = getWordsForCurrentMode();
            if (!result) return;
            
            currentDayWords = [...result.words];
            shuffleArray(currentDayWords);
            currentWordIndex = 0;
            score = 0;
            quizActive = true;
            studyActive = false;
            currentDayInfo = result.dayInfo;
            
            updateAchievementDisplay();
            
            activeQuestionType = document.querySelector('input[name="quizType"]:checked').value;
            displayQuizQuestion();
        }

        function displayQuizQuestion() {
            clearGameArea();
            
            if (currentWordIndex >= currentDayWords.length) {
                // ÌÄ¥Ï¶à ÏôÑÎ£å
                document.getElementById('wordDisplay').textContent = 'ÌÄ¥Ï¶à ÏôÑÎ£å! üéâ';
                document.getElementById('statusText').textContent = `--- ${currentDayInfo} ÌÄ¥Ï¶à ÏôÑÎ£å! ---`;
                document.getElementById('meaningDisplay').textContent = `Ï†êÏàò: ${score}/${currentDayWords.length}`;
                return;
            }
            
            const [eng, kor] = currentDayWords[currentWordIndex];
            const stats = getStats(eng, kor);
            selectedOption = null;
            
            // mixed Î™®ÎìúÏùº Í≤ΩÏö∞ ÎûúÎç§ÌïòÍ≤å ÌÄ¥Ï¶à ÌÉÄÏûÖ ÏÑ†ÌÉù
            if (activeQuestionType === 'mixed') {
                const types = ['eng_to_kor', 'kor_to_eng', 'fill_blank'];
                activeQuestionType = types[Math.floor(Math.random() * types.length)];
            }
            
            document.getElementById('statusText').textContent = `--- ${currentDayInfo} ÌÄ¥Ï¶à (${currentWordIndex + 1}/${currentDayWords.length}) ---`;
            document.getElementById('feedback').textContent = '';
            
            if (activeQuestionType === 'eng_to_kor') {
                setupEngToKorQuiz(eng, kor, stats);
            } else if (activeQuestionType === 'kor_to_eng') {
                setupKorToEngQuiz(eng, kor, stats);
            } else if (activeQuestionType === 'fill_blank') {
                setupFillBlankQuiz(eng, kor, stats);
            }
            
            setupQuizButtons();
        }

        function setupEngToKorQuiz(eng, kor, stats) {
            document.getElementById('wordDisplay').textContent = `${currentWordIndex + 1}. ${eng}`;
            document.getElementById('meaningDisplay').textContent = `(ÌïôÏäµ:${stats[0]}, ÌÄ¥Ï¶à:${stats[1]}, Ï†ïÎãµ:${stats[2]})`;
            
            const allKors = currentDayWords.map(([, k]) => k);
            const options = makeOptions(kor, allKors);
            createQuizOptions(options);
        }

        function setupKorToEngQuiz(eng, kor, stats) {
            document.getElementById('wordDisplay').textContent = `${currentWordIndex + 1}. ${kor}`;
            document.getElementById('meaningDisplay').textContent = `(ÌïôÏäµ:${stats[0]}, ÌÄ¥Ï¶à:${stats[1]}, Ï†ïÎãµ:${stats[2]})`;
            
            const allEngs = currentDayWords.map(([e]) => e);
            const options = makeOptions(eng, allEngs);
            createQuizOptions(options);
        }

        function setupFillBlankQuiz(eng, kor, stats) {
            const blankedWord = generateBlankedWord(eng);
            document.getElementById('wordDisplay').textContent = `${currentWordIndex + 1}. ${blankedWord}`;
            document.getElementById('meaningDisplay').textContent = `Îúª: ${kor} (ÌïôÏäµ:${stats[0]}, ÌÄ¥Ï¶à:${stats[1]}, Ï†ïÎãµ:${stats[2]})`;
            
            const answerInput = document.getElementById('answerInput');
            answerInput.value = '';
            answerInput.classList.remove('hidden');
            answerInput.disabled = false;
            answerInput.focus();
        }

        function makeOptions(correct, allOptions, num = 4) {
            const options = [correct];
            const candidates = allOptions.filter(item => item !== correct);
            
            while (options.length < num && candidates.length > 0) {
                const randomIndex = Math.floor(Math.random() * candidates.length);
                options.push(candidates.splice(randomIndex, 1)[0]);
            }
            
            return shuffleArray(options);
        }

        function createQuizOptions(options) {
            const container = document.getElementById('quizOptions');
            container.innerHTML = '';
            container.classList.remove('hidden');
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => selectOption(option, button);
                container.appendChild(button);
            });
        }

        function selectOption(option, button) {
            selectedOption = option;
            
            // Î™®Îì† ÏòµÏÖò Ïä§ÌÉÄÏùº Î¶¨ÏÖã
            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ÏÑ†ÌÉùÎêú ÏòµÏÖò Ïä§ÌÉÄÏùº Ï†ÅÏö©
            button.classList.add('selected');
            
            // Ï†úÏ∂ú Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.getElementById('actionButton1').disabled = false;
        }

        function setupQuizButtons() {
            const button1 = document.getElementById('actionButton1');
            const button2 = document.getElementById('actionButton2');
            
            button1.textContent = 'Ï†úÏ∂ú';
            button1.className = 'btn-action btn-submit';
            button1.onclick = checkQuizAnswer;
            button1.disabled = activeQuestionType === 'fill_blank';
            button1.classList.remove('hidden');
            
            button2.textContent = 'Îã§Ïùå Î¨∏Ï†ú';
            button2.className = 'btn-action btn-next';
            button2.onclick = nextQuizQuestion;
            button2.disabled = true;
            button2.classList.remove('hidden');
        }

        function checkQuizAnswer() {
            if (!quizActive || currentWordIndex >= currentDayWords.length) return;
            
            const [eng, kor] = currentDayWords[currentWordIndex];
            updateStats(eng, kor, 1); // ÌÄ¥Ï¶à ÏãúÎèÑ ÌöüÏàò Ï¶ùÍ∞Ä
            
            let isCorrect = false;
            let correctAnswer = '';
            
            if (activeQuestionType === 'eng_to_kor') {
                if (selectedOption === null) {
                    showFeedback('ÏòµÏÖòÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Ï†úÏ∂úÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }
                isCorrect = selectedOption === kor;
                correctAnswer = kor;
            } else if (activeQuestionType === 'kor_to_eng') {
                if (selectedOption === null) {
                    showFeedback('ÏòµÏÖòÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Ï†úÏ∂úÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }
                isCorrect = selectedOption === eng;
                correctAnswer = eng;
            } else if (activeQuestionType === 'fill_blank') {
                const userAnswer = document.getElementById('answerInput').value.trim();
                if (!userAnswer) {
                    showFeedback('ÎãµÏùÑ ÏûÖÎ†•ÌïòÍ≥† Ï†úÏ∂úÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }
                isCorrect = userAnswer.toLowerCase() === eng.toLowerCase();
                correctAnswer = eng;
                document.getElementById('answerInput').disabled = true;
            }
            
            if (isCorrect) {
                showFeedback('Ï†ïÎãµ! üéâ', 'correct');
                score++;
                updateStats(eng, kor, 2); // Ï†ïÎãµÌöüÏàò Ï¶ùÍ∞Ä
                
                // ÏÑ±Ï∑®Ï†êÏàò Ï¶ùÍ∞Ä
                achievementScore++;
                achievementData.total = achievementScore;
                updateAchievementDisplay();
                // Î©îÎ™®Î¶¨ÏóêÎßå Ï†ÄÏû• (ÏÑ∏ÏÖò ÎèôÏïà Ïú†ÏßÄ)
            } else {
                showFeedback(`Ïò§Îãµ! Ï†ïÎãµ: ${correctAnswer}`, 'incorrect');
            }
            
            // Î™®Îì† ÏòµÏÖò Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.disabled = true;
            });
            
            document.getElementById('actionButton1').disabled = true;
            document.getElementById('actionButton2').disabled = false;
        }

        function nextQuizQuestion() {
            if (quizActive) {
                currentWordIndex++;
                activeQuestionType = document.querySelector('input[name="quizType"]:checked').value;
                displayQuizQuestion();
            }
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
        }

        function clearGameArea() {
            document.getElementById('wordDisplay').textContent = '';
            document.getElementById('meaningDisplay').textContent = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('quizOptions').classList.add('hidden');
            document.getElementById('answerInput').classList.add('hidden');
            document.getElementById('actionButton1').classList.add('hidden');
            document.getElementById('actionButton2').classList.add('hidden');
        }

        function onAnswerEntryChange() {
            if (quizActive && activeQuestionType === 'fill_blank') {
                const hasText = document.getElementById('answerInput').value.trim().length > 0;
                document.getElementById('actionButton1').disabled = !hasText;
            }
        }

        function generateBlankedWord(word) {
            if (word.length <= 3) {
                return '_'.repeat(word.length);
            }
            
            const numBlanks = Math.min(2, Math.floor(word.length / 3));
            const positions = [];
            
            while (positions.length < numBlanks) {
                const pos = Math.floor(Math.random() * word.length);
                if (!positions.includes(pos)) {
                    positions.push(pos);
                }
            }
            
            return word.split('').map((char, index) => 
                positions.includes(index) ? '_' : char
            ).join('');
        }

        function updateStats(eng, kor, statIdx) {
            const key = `${eng}|${kor}`;
            if (!statsData[key]) {
                statsData[key] = [0, 0, 0];
            }
            statsData[key][statIdx]++;
            // Î©îÎ™®Î¶¨ÏóêÎßå Ï†ÄÏû• (ÏÑ∏ÏÖò ÎèôÏïà Ïú†ÏßÄ)
        }

        function getStats(eng, kor) {
            const key = `${eng}|${kor}`;
            return statsData[key] || [0, 0, 0];
        }

        function updateAchievementDisplay() {
            document.getElementById('achievementScore').textContent = achievementScore;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
